# 随机粒子衰变链生成器

## 简介

这是一个用于随机生成粒子衰变链的Python程序，它允许用户**自定义粒子库**、**定义衰变模式**以及**选择物理规则**，从而生成符合物理定律的粒子衰变链。程序还提供了**去重机制**，确保生成的衰变链唯一且对粒子顺序不敏感。

## 主要功能与特色

- **自定义粒子库**: 自由定义粒子属性，包括基本量子数、高级量子数、质量、寿命及衰变模式等。
- **灵活的衰变模式**: 支持预设衰变模式和随机生成衰变产物，满足不同需求。
- **可选择的物理规则**: 根据需要选择遵守的物理规则，如电荷守恒、能量守恒等。
- **去重机制**: 内置去重功能，避免生成重复的衰变链。
- **顺序无关性**: 衰变链生成对粒子顺序不敏感，相同的粒子组合被视为相同的衰变链。

## 关键实现路径

### `DecayChainGenerator` 类的 `generate()` 方法
1. **计算初态量子数**: 首先计算初始粒子组合的总量子数和属性。
2. **抽样末态粒子**: 随机选择末态粒子组合，粒子数量在预设范围内。
3. **检查守恒规则**: 使用 `ConservationChecker` 检查末态粒子组合是否满足所有启用的守恒定律。如果不满足，重新抽样。
4. **展开中间态**: 递归展开末态粒子中的潜在中间态，将中间态替换为它们的衰变产物，直到所有粒子都是稳定粒子或达到最大递归深度。
5. **去重处理**: 将生成的衰变链与缓存内容进行比较，确保结果唯一。如果衰变链已在缓存中，则重新生成；否则，将新衰变链添加到缓存并返回。

## 使用方法

### 1. 创建粒子数据库

使用 `create_particle_database()` 函数创建示例数据库，或根据需求自定义粒子库。

```python
particle_db = create_particle_database()
```

### 2. 设置守恒规则

定义需要遵守的守恒规则。

```python
conservation_rules = {
    'charge': True,
    'energy': True,
    'strangeness': True,
    'baryon_number': True,
    'lepton_number': True
}
```

### 3. 创建衰变链生成器

创建衰变链生成器实例，传入粒子数据库、守恒规则和可选参数。

```python
ecms = 3097.0  # 单位为MeV
generator = DecayChainGenerator(particle_db, conservation_rules, ecms, max_depth=10, max_final_particles=8)
```

### 4. 生成衰变链

调用 `generate()` 方法，传入初始粒子名称列表，生成完整的衰变链字符串。

```python
chain = generator.generate(["e⁺", "e⁻"])
print(chain)
```

## 示例输出

可能的衰变链输出示例：

```
e⁺ e⁻ -> [J/ψ -> μ⁺ μ⁻]
e⁺ e⁻ -> [φ -> K⁺ K⁻]
e⁺ e⁻ -> [π⁰ -> γ γ] [π⁰ -> γ γ]
```

## 扩展功能

- **更多粒子类型**: 支持更广泛的物理过程，如添加夸克、胶子等粒子类型。
- **复杂衰变模型**: 实现多体衰变、共振态等更复杂的衰变模型。